<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion</title>
    <link rel="icon" href="data:,"> <!-- bloque la demande de favoricon.ico -->
</head>

<body>
    <div id=divdroit> <img src="https://www.educol.net/coloriage-maison-dl28263.jpg" width="40px" alt=""></a></div>

    <legend>
        <form id="formConnexion">
            <h1>Connexion</h1>
            <table>
                <tr>
                    <td colspan="2"><input id="email" placeholder="email*" type="email" name="email" required></td>
                </tr>
                <tr>
                    <td colspan="2"><input id="password" placeholder="password*" type="password" name="password"
                            required></td>
                </tr>
                <tr>
                    <td><button id="Inscription" type="button" onclick="Connect()">S'inscrire'</button></td>
                    <td><button id="Connecxion" type="submit">se connecter</button></td>
                </tr>
            </table>
    </legend>
    </form>

    <script scr="connexion.js">
        console.log("Script chargé !");
        document.getElementById('formConnexion').addEventListener('submit', function (event) {
            event.preventDefault();  // Empêche la soumission du formulaire classique
            console.log("Le formulaire est soumis");
            testeconnexion(event);
        });



        async function recupMDPResident(mail) {
            try {
                const response = await fetch(`http://localhost:5000/Recherche_Resident_mail?mail=${mail}`);
                const data = await response.json();

                if (data.length === 0) {
                    console.log('Aucun résident trouvée.');
                    return -1;
                }
                console.log("id du résident: ", data[0].id);
                return data[0];
            } catch (error) {
                console.error('Erreur:', error);
                return -1;
            }
        }

        async function testeconnexion(event) {
            event.preventDefault();
            const mail = document.getElementById("email").value;
            const mdp = document.getElementById("password").value;

            const Resident = await recupMDPResident(mail);
            if (Resident.mdp == mdp) {
                //à rajouter l'id dans un cookie ou un truc dans le genre
                window.location.href="accueuil.html"
            }
        }
        function Connect() {
            window.location.href = "inscription.html";
        }
    </script>
</body>

</html>